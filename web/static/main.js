(()=>{"use strict";var e,t={7788:(e,t,r)=>{r.r(t),r.d(t,{MIDIFile:()=>s,startLoad:()=>g,startPlay:()=>p});var n={isNotUTF8:function(e,t,r){try{n.getStringFromBytes(e,t,r,!0)}catch(e){return!0}return!1},getCharLength:function(e){return 240==(240&e)?4:224==(224&e)?3:192==(192&e)?2:e==(127&e)?1:0},getCharCode:function(e,t,r){var a=0,i="";if(t=t||0,e.length-t<=0)throw new Error("No more characters remaining in array.");if(0==(r=r||n.getCharLength(e[t])))throw new Error(e[t].toString(2)+" is not a significative byte (offset:"+t+").");if(1===r)return e[t];if(e.length-t<r)throw new Error("Expected at least "+r+" bytes remaining in array.");if(i="00000000".slice(0,r)+1+"00000000".slice(r+1),e[t]&parseInt(i,2))throw Error("Index "+t+": A "+r+" bytes encoded char cannot encode the "+(r+1)+"th rank bit to 1.");for(i="0000".slice(0,r+1)+"11111111".slice(r+1),a+=(e[t]&parseInt(i,2))<<6*--r;r;){if(128!=(128&e[t+1])||64==(64&e[t+1]))throw Error("Index "+(t+1)+': Next bytes of encoded char must begin with a "10" bit sequence.');a+=(63&e[++t])<<6*--r}return a},getStringFromBytes:function(e,t,r,a){var i,o=[];for(t|=0,r="number"==typeof r?r:e.byteLength||e.length;t<r;t++){if(t+(i=n.getCharLength(e[t]))>r){if(a)throw Error("Index "+t+": Found a "+i+" bytes encoded char declaration but only "+(r-t)+" bytes are available.")}else o.push(String.fromCodePoint(n.getCharCode(e,t,i,a)));t+=i-1}return o.join("")},getBytesForCharCode:function(e){if(e<128)return 1;if(e<2048)return 2;if(e<65536)return 3;if(e<2097152)return 4;throw new Error("CharCode "+e+" cannot be encoded with UTF8.")},setBytesFromCharCode:function(e,t,r,a){if(e|=0,t=t||[],r|=0,1==(a=a||n.getBytesForCharCode(e)))t[r]=e;else for(t[r++]=(parseInt("1111".slice(0,a),2)<<8-a)+(e>>>6*--a);a>0;)t[r++]=e>>>6*--a&63|128;return t},setBytesFromString:function(e,t,r,a,i){e=e||"",t=t||[],r|=0,a="number"==typeof a?a:t.byteLength||1/0;for(var o=0,s=e.length;o<s;o++){var l=n.getBytesForCharCode(e[o].codePointAt(0));if(i&&r+l>a)throw new Error('Not enought bytes to encode the char "'+e[o]+'" at the offset "'+r+'".');n.setBytesFromCharCode(e[o].codePointAt(0),t,r,l,i),r+=l}return t}};function a(){throw new Error("MIDIEvents function not intended to be run.")}function i(e){let t;if(e){if(!(e instanceof ArrayBuffer))throw Error("Invalid buffer received.");if(this.datas=new DataView(e,0,i.HEADER_LENGTH),"M"!==String.fromCharCode(this.datas.getUint8(0))||"T"!==String.fromCharCode(this.datas.getUint8(1))||"h"!==String.fromCharCode(this.datas.getUint8(2))||"d"!==String.fromCharCode(this.datas.getUint8(3)))throw new Error("Invalid MIDIFileHeader : MThd prefix not found");if(6!==this.datas.getUint32(4))throw new Error("Invalid MIDIFileHeader : Chunk length must be 6")}else t=new Uint8Array(i.HEADER_LENGTH),t[0]=77,t[1]=84,t[2]=104,t[3]=100,t[4]=0,t[5]=0,t[6]=0,t[7]=6,t[8]=0,t[9]=1,t[10]=0,t[11]=1,t[12]=0,t[13]=192,this.datas=new DataView(t.buffer,0,i.HEADER_LENGTH)}function o(e,t){let r,n;if(e){if(!(e instanceof ArrayBuffer))throw new Error("Invalid buffer received.");if(12>e.byteLength-t)throw new Error("Invalid MIDIFileTrack (0x"+t.toString(16)+") : Buffer length must size at least 12bytes");if(this.datas=new DataView(e,t,o.HDR_LENGTH),"M"!==String.fromCharCode(this.datas.getUint8(0))||"T"!==String.fromCharCode(this.datas.getUint8(1))||"r"!==String.fromCharCode(this.datas.getUint8(2))||"k"!==String.fromCharCode(this.datas.getUint8(3)))throw new Error("Invalid MIDIFileTrack (0x"+t.toString(16)+") : MTrk prefix not found");if(n=this.getTrackLength(),e.byteLength-t<n)throw new Error("Invalid MIDIFileTrack (0x"+t.toString(16)+") : The track size exceed the buffer length.");if(this.datas=new DataView(e,t,o.HDR_LENGTH+n),255!==this.datas.getUint8(o.HDR_LENGTH+(n-3))||47!==this.datas.getUint8(o.HDR_LENGTH+(n-2))||0!==this.datas.getUint8(o.HDR_LENGTH+(n-1)))throw new Error("Invalid MIDIFileTrack (0x"+t.toString(16)+") : No track end event found at the expected index ("+(o.HDR_LENGTH+(n-1)).toString(16)+").")}else r=new Uint8Array(12),r[0]=77,r[1]=84,r[2]=114,r[3]=107,r[4]=0,r[5]=0,r[6]=0,r[7]=4,r[8]=0,r[9]=255,r[10]=47,r[11]=0,this.datas=new DataView(r.buffer,0,o.HDR_LENGTH+4)}a.EVENT_META=255,a.EVENT_SYSEX=240,a.EVENT_DIVSYSEX=247,a.EVENT_MIDI=8,a.EVENT_META_SEQUENCE_NUMBER=0,a.EVENT_META_TEXT=1,a.EVENT_META_COPYRIGHT_NOTICE=2,a.EVENT_META_TRACK_NAME=3,a.EVENT_META_INSTRUMENT_NAME=4,a.EVENT_META_LYRICS=5,a.EVENT_META_MARKER=6,a.EVENT_META_CUE_POINT=7,a.EVENT_META_MIDI_CHANNEL_PREFIX=32,a.EVENT_META_END_OF_TRACK=47,a.EVENT_META_SET_TEMPO=81,a.EVENT_META_SMTPE_OFFSET=84,a.EVENT_META_TIME_SIGNATURE=88,a.EVENT_META_KEY_SIGNATURE=89,a.EVENT_META_SEQUENCER_SPECIFIC=127,a.EVENT_MIDI_NOTE_OFF=8,a.EVENT_MIDI_NOTE_ON=9,a.EVENT_MIDI_NOTE_AFTERTOUCH=10,a.EVENT_MIDI_CONTROLLER=11,a.EVENT_MIDI_PROGRAM_CHANGE=12,a.EVENT_MIDI_CHANNEL_AFTERTOUCH=13,a.EVENT_MIDI_PITCH_BEND=14,a.MIDI_1PARAM_EVENTS=[a.EVENT_MIDI_PROGRAM_CHANGE,a.EVENT_MIDI_CHANNEL_AFTERTOUCH],a.MIDI_2PARAMS_EVENTS=[a.EVENT_MIDI_NOTE_OFF,a.EVENT_MIDI_NOTE_ON,a.EVENT_MIDI_NOTE_AFTERTOUCH,a.EVENT_MIDI_CONTROLLER,a.EVENT_MIDI_PITCH_BEND],a.createParser=function(e,t,r){var n,i,o,s,l;if(e instanceof DataView&&(e={position:t||0,buffer:e,readUint8:function(){return this.buffer.getUint8(this.position++)},readUint16:function(){var e=this.buffer.getUint16(this.position);return this.position=this.position+2,e},readUint32:function(){var e=this.buffer.getUint16(this.position);return this.position=this.position+2,e},readVarInt:function(){for(var e,t=0,r=0;4>r++;){if(!(128&(e=this.readUint8())))return t+e;t+=127&e,t<<=7}throw new Error("0x"+this.position.toString(16)+": Variable integer length cannot exceed 4 bytes")},readBytes:function(e){for(var t=[];0<e;e--)t.push(this.readUint8());return t},pos:function(){return"0x"+(this.buffer.byteOffset+this.position).toString(16)},end:function(){return this.position===this.buffer.byteLength}},t=0),0<t)for(;t--;)e.readUint8();return{next:function(){if(e.end())return null;if(i={index:e.pos(),delta:e.readVarInt()},240==(240&(n=e.readUint8()))){if(n!==a.EVENT_META){if(n===a.EVENT_SYSEX||n===a.EVENT_DIVSYSEX)return i.type=n,i.length=e.readVarInt(),i.data=e.readBytes(i.length),i;if(r)throw new Error(e.pos()+" Unknown event type "+n.toString(16)+", Delta: "+i.delta+".");return i.type=n,i.badsubtype=e.readVarInt(),i.length=e.readUint8(),i.data=e.readBytes(i.length),i}switch(i.type=a.EVENT_META,i.subtype=e.readUint8(),i.length=e.readVarInt(),i.subtype){case a.EVENT_META_SEQUENCE_NUMBER:if(r&&2!==i.length)throw new Error(e.pos()+" Bad metaevent length.");return i.msb=e.readUint8(),i.lsb=e.readUint8(),i;case a.EVENT_META_TEXT:case a.EVENT_META_COPYRIGHT_NOTICE:case a.EVENT_META_TRACK_NAME:case a.EVENT_META_INSTRUMENT_NAME:case a.EVENT_META_LYRICS:case a.EVENT_META_MARKER:case a.EVENT_META_CUE_POINT:return i.data=e.readBytes(i.length),i;case a.EVENT_META_MIDI_CHANNEL_PREFIX:if(r&&1!==i.length)throw new Error(e.pos()+" Bad metaevent length.");return i.prefix=e.readUint8(),i;case a.EVENT_META_END_OF_TRACK:if(r&&0!==i.length)throw new Error(e.pos()+" Bad metaevent length.");return i;case a.EVENT_META_SET_TEMPO:if(r&&3!==i.length)throw new Error(e.pos()+" Tempo meta event length must be 3.");return i.tempo=(e.readUint8()<<16)+(e.readUint8()<<8)+e.readUint8(),i.tempoBPM=6e7/i.tempo,i;case a.EVENT_META_SMTPE_OFFSET:if(r&&5!==i.length)throw new Error(e.pos()+" Bad metaevent length.");if(i.hour=e.readUint8(),r&&23<i.hour)throw new Error(e.pos()+" SMTPE offset hour value must be part of 0-23.");if(i.minutes=e.readUint8(),r&&59<i.minutes)throw new Error(e.pos()+" SMTPE offset minutes value must be part of 0-59.");if(i.seconds=e.readUint8(),r&&59<i.seconds)throw new Error(e.pos()+" SMTPE offset seconds value must be part of 0-59.");if(i.frames=e.readUint8(),r&&30<i.frames)throw new Error(e.pos()+" SMTPE offset frames value must be part of 0-30.");if(i.subframes=e.readUint8(),r&&99<i.subframes)throw new Error(e.pos()+" SMTPE offset subframes value must be part of 0-99.");return i;case a.EVENT_META_KEY_SIGNATURE:if(r&&2!==i.length)throw new Error(e.pos()+" Bad metaevent length.");if(i.key=e.readUint8(),r&&(-7>i.key||7<i.key))throw new Error(e.pos()+" Bad metaevent length.");if(i.scale=e.readUint8(),r&&0!==i.scale&&1!==i.scale)throw new Error(e.pos()+" Key signature scale value must be 0 or 1.");return i;case a.EVENT_META_TIME_SIGNATURE:if(r&&4!==i.length)throw new Error(e.pos()+" Bad metaevent length.");return i.data=e.readBytes(i.length),i.param1=i.data[0],i.param2=i.data[1],i.param3=i.data[2],i.param4=i.data[3],i;case a.EVENT_META_SEQUENCER_SPECIFIC:return i.data=e.readBytes(i.length),i;default:if(r)throw new Error(e.pos()+" Unknown meta event type ("+i.subtype.toString(16)+").");return i.data=e.readBytes(i.length),i}}else{if(0==(128&n)){if(!o)throw new Error(e.pos()+" Running status without previous event");l=n}else o=n>>4,s=15&n,l=e.readUint8();switch(i.type=a.EVENT_MIDI,i.subtype=o,i.channel=s,i.param1=l,o){case a.EVENT_MIDI_NOTE_OFF:return i.param2=e.readUint8(),i;case a.EVENT_MIDI_NOTE_ON:return i.param2=e.readUint8(),i.param2||(i.subtype=a.EVENT_MIDI_NOTE_OFF,i.param2=127),i;case a.EVENT_MIDI_NOTE_AFTERTOUCH:case a.EVENT_MIDI_CONTROLLER:return i.param2=e.readUint8(),i;case a.EVENT_MIDI_PROGRAM_CHANGE:case a.EVENT_MIDI_CHANNEL_AFTERTOUCH:return i;case a.EVENT_MIDI_PITCH_BEND:return i.param2=e.readUint8(),i;default:if(r)throw new Error(e.pos()+" Unknown MIDI event type ("+o.toString(16)+").");return i}}}}},a.writeToTrack=function(e,t,r){var n,i,o,s,l=0;for(n=0,i=e.length;n<i;n++){if(e[n].delta>>>28)throw Error("Event #"+n+": Maximum delta time value reached ("+e[n].delta+"/134217728 max)");if(e[n].delta>>>21&&(t[l++]=e[n].delta>>>21&127|128),e[n].delta>>>14&&(t[l++]=e[n].delta>>>14&127|128),e[n].delta>>>7&&(t[l++]=e[n].delta>>>7&127|128),t[l++]=127&e[n].delta,e[n].type===a.EVENT_MIDI)t[l++]=(e[n].subtype<<4)+e[n].channel,t[l++]=e[n].param1,-1!==a.MIDI_2PARAMS_EVENTS.indexOf(e[n].subtype)&&(t[l++]=e[n].param2);else{if(t[l++]=e[n].type,e[n].type===a.EVENT_META&&(t[l++]=e[n].subtype),e[n].length>>>28)throw Error("Event #"+n+": Maximum length reached ("+e[n].length+"/134217728 max)");if(e[n].length>>>21&&(t[l++]=e[n].length>>>21&127|128),e[n].length>>>14&&(t[l++]=e[n].length>>>14&127|128),e[n].length>>>7&&(t[l++]=e[n].length>>>7&127|128),t[l++]=127&e[n].length,e[n].type===a.EVENT_META)switch(e[n].subtype){case a.EVENT_META_SEQUENCE_NUMBER:t[l++]=e[n].msb,t[l++]=e[n].lsb;break;case a.EVENT_META_TEXT:case a.EVENT_META_COPYRIGHT_NOTICE:case a.EVENT_META_TRACK_NAME:case a.EVENT_META_INSTRUMENT_NAME:case a.EVENT_META_LYRICS:case a.EVENT_META_MARKER:case a.EVENT_META_CUE_POINT:for(o=0,s=e[n].length;o<s;o++)t[l++]=e[n].data[o];break;case a.EVENT_META_MIDI_CHANNEL_PREFIX:t[l++]=e[n].prefix;break;case a.EVENT_META_END_OF_TRACK:break;case a.EVENT_META_SET_TEMPO:t[l++]=e[n].tempo>>16,t[l++]=e[n].tempo>>8&255,t[l++]=255&e[n].tempo;break;case a.EVENT_META_SMTPE_OFFSET:if(r&&23<e[n].hour)throw new Error("Event #"+n+": SMTPE offset hour value must be part of 0-23.");if(t[l++]=e[n].hour,r&&59<e[n].minutes)throw new Error("Event #"+n+": SMTPE offset minutes value must be part of 0-59.");if(t[l++]=e[n].minutes,r&&59<e[n].seconds)throw new Error("Event #"+n+": SMTPE offset seconds value must be part of 0-59.");if(t[l++]=e[n].seconds,r&&30<e[n].frames)throw new Error("Event #"+n+": SMTPE offset frames amount must be part of 0-30.");if(t[l++]=e[n].frames,r&&99<e[n].subframes)throw new Error("Event #"+n+": SMTPE offset subframes amount must be part of 0-99.");t[l++]=e[n].subframes;break;case a.EVENT_META_KEY_SIGNATURE:if("number"!=typeof e[n].key||-7>e[n].key||7<e[n].scale)throw new Error("Event #"+n+":The key signature key must be between -7 and 7");if("number"!=typeof e[n].scale||0>e[n].scale||1<e[n].scale)throw new Error("Event #"+n+":The key signature scale must be 0 or 1");t[l++]=e[n].key,t[l++]=e[n].scale;break;case a.EVENT_META_TIME_SIGNATURE:case a.EVENT_META_SEQUENCER_SPECIFIC:default:for(o=0,s=e[n].length;o<s;o++)t[l++]=e[n].data[o]}else for(o=0,s=e[n].length;o<s;o++)t[l++]=e[n].data[o]}}},a.getRequiredBufferLength=function(e){var t,r=0,n=0;for(n=0,t=e.length;n<t;n++)r+=e[n].delta>>>21?4:e[n].delta>>>14?3:e[n].delta>>>7?2:1,e[n].type===a.EVENT_MIDI?(r++,r++,-1!==a.MIDI_2PARAMS_EVENTS.indexOf(e[n].subtype)&&r++):(r++,e[n].type===a.EVENT_META&&r++,r+=e[n].length>>>21?4:e[n].length>>>14?3:e[n].length>>>7?2:1,r+=e[n].length);return r},i.HEADER_LENGTH=14,i.FRAMES_PER_SECONDS=1,i.TICKS_PER_BEAT=2,i.prototype.getFormat=function(){const e=this.datas.getUint16(8);if(0!==e&&1!==e&&2!==e)throw new Error("Invalid MIDI file : MIDI format ("+e+"), format can be 0, 1 or 2 only.");return e},i.prototype.setFormat=function(e){if(0!==e&&1!==e&&2!==e)throw new Error("Invalid MIDI format given ("+e+"), format can be 0, 1 or 2 only.");this.datas.setUint16(8,e)},i.prototype.getTracksCount=function(){return this.datas.getUint16(10)},i.prototype.setTracksCount=function(e){return this.datas.setUint16(10,e)},i.prototype.getTickResolution=function(e){return 32768&this.datas.getUint16(12)?1e6/(this.getSMPTEFrames()*this.getTicksPerFrame()):(e=e||5e5)/this.getTicksPerBeat()},i.prototype.getTimeDivision=function(){return 32768&this.datas.getUint16(12)?i.FRAMES_PER_SECONDS:i.TICKS_PER_BEAT},i.prototype.getTicksPerBeat=function(){var e=this.datas.getUint16(12);if(32768&e)throw new Error("Time division is not expressed as ticks per beat.");return e},i.prototype.setTicksPerBeat=function(e){this.datas.setUint16(12,32767&e)},i.prototype.getSMPTEFrames=function(){const e=this.datas.getUint16(12);let t;if(!(32768&e))throw new Error("Time division is not expressed as frames per seconds.");if(t=32512&e,-1===[24,25,29,30].indexOf(t))throw new Error("Invalid SMPTE frames value ("+t+").");return 29===t?29.97:t},i.prototype.getTicksPerFrame=function(){const e=this.datas.getUint16(12);if(!(32768&e))throw new Error("Time division is not expressed as frames per seconds.");return 255&e},i.prototype.setSMTPEDivision=function(e,t){if(29.97===e&&(e=29),-1===[24,25,29,30].indexOf(e))throw new Error("Invalid SMPTE frames value given ("+e+").");if(0>t||255<t)throw new Error("Invalid ticks per frame value given ("+e+").");this.datas.setUint8(12,128|e),this.datas.setUint8(13,t)},o.HDR_LENGTH=8,o.prototype.getTrackLength=function(){return this.datas.getUint32(4)},o.prototype.setTrackLength=function(e){return this.datas.setUint32(4,e)},o.prototype.getTrackContent=function(){return new DataView(this.datas.buffer,this.datas.byteOffset+o.HDR_LENGTH,this.datas.byteLength-o.HDR_LENGTH)},o.prototype.setTrackContent=function(e){let t,r,n,a;const i=e.byteLength-e.byteOffset;if(4>i)throw new Error("Invalid track length, must size at least 4bytes");for(this.datas=new DataView(new Uint8Array(o.HDR_LENGTH+i).buffer),this.datas.setUint8(0,77),this.datas.setUint8(1,84),this.datas.setUint8(2,114),this.datas.setUint8(3,107),this.datas.setUint32(4,i),t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),r=new Uint8Array(this.datas.buffer,o.HDR_LENGTH,i),n=0,a=t.length;n<a;n++)r[n]=t[n]};class s{constructor(e,t){var r,n,a,s;if(e){if(25>(e=function(e){if(e){if(e instanceof ArrayBuffer)return e;if(e instanceof Uint8Array)return new Uint8Array(e).buffer}throw new Error("Unsupported buffer type, need ArrayBuffer or Uint8Array")}(e)).byteLength)throw new Error("A buffer of a valid MIDI file must have, at least, a size of 25bytes.");for(this.header=new i(e,t),this.tracks=[],n=i.HEADER_LENGTH,a=0,s=this.header.getTracksCount();a<s;a++){if(t&&n>=e.byteLength-1)throw new Error("Couldn't find datas corresponding to the track #"+a+".");r=new o(e,n,t),this.tracks.push(r),n+=r.getTrackLength()+8}if(t&&n!==e.byteLength)throw new Error("It seems that the buffer contains too much datas.")}else this.header=new i,this.tracks=[new o]}startNote=function(e,t){this.takeTrack(e.channel,t).notes.push({when:e.playTime/1e3,pitch:e.param1,duration:1e-7,slides:[]})};closeNote=function(e,t){for(var r=this.takeTrack(e.channel,t),n=0;n<r.notes.length;n++)if(1e-7==r.notes[n].duration&&r.notes[n].pitch==e.param1&&r.notes[n].when<e.playTime/1e3){r.notes[n].duration=e.playTime/1e3-r.notes[n].when;break}};addSlide=function(e,t){for(var r=this.takeTrack(e.channel,t),n=0;n<r.notes.length;n++)1e-7==r.notes[n].duration&&r.notes[n].when<e.playTime/1e3&&r.notes[n].slides.push({delta:(e.param2-64)/6,when:e.playTime/1e3-r.notes[n].when})};startDrum=function(e,t){this.takeBeat(e.param1,t).notes.push({when:e.playTime/1e3})};takeTrack=function(e,t){for(var r=0;r<t.tracks.length;r++)if(t.tracks[r].n==e)return t.tracks[r];var n={n:e,notes:[],volume:1,program:0};return t.tracks.push(n),n};takeBeat=function(e,t){for(var r=0;r<t.beats.length;r++)if(t.beats[r].n==e)return t.beats[r];var n={n:e,notes:[],volume:1};return t.beats.push(n),n};parseSong=function(){for(var e={duration:0,tracks:[],beats:[]},t=this.getMidiEvents(),r=0;r<t.length;r++)e.duration<t[r].playTime/1e3&&(e.duration=t[r].playTime/1e3),t[r].subtype==a.EVENT_MIDI_NOTE_ON?9==t[r].channel?t[r].param1>=35&&t[r].param1<=81?this.startDrum(t[r],e):console.log("wrong drum",t[r]):t[r].param1>=0&&t[r].param1<=127?this.startNote(t[r],e):console.log("wrong tone",t[r]):t[r].subtype==a.EVENT_MIDI_NOTE_OFF?9!=t[r].channel&&this.closeNote(t[r],e):t[r].subtype==a.EVENT_MIDI_PROGRAM_CHANGE?9!=t[r].channel?this.takeTrack(t[r].channel,e).program=t[r].param1:console.log("skip program for drums"):t[r].subtype==a.EVENT_MIDI_CONTROLLER?7==t[r].param1&&9!=t[r].channel&&(this.takeTrack(t[r].channel,e).volume=t[r].param2/127||1e-6):t[r].subtype==a.EVENT_MIDI_PITCH_BEND?this.addSlide(t[r],e):console.log("unknown",t[r].channel,t[r]);return e};getEvents=function(e,t){var r,n,i,o,s,l,u=0,d=[],c=this.header.getFormat(),f=this.header.getTickResolution();if(1!==c||1===this.tracks.length)for(i=0,o=this.tracks.length;i<o;i++)for(u=2===c&&u?u:0,n=(r=a.createParser(this.tracks[i].getTrackContent(),0,!1)).next();n;)u+=n.delta?n.delta*f/1e3:0,n.type===a.EVENT_META&&n.subtype===a.EVENT_META_SET_TEMPO&&(f=this.header.getTickResolution(n.tempo)),e&&n.type!==e||t&&(!n.subtype||n.subtype!==t)||(n.playTime=u,d.push(n)),n=r.next();else{for(s=[],l=-1,i=0,o=this.tracks.length;i<o;i++)s[i]={},s[i].parser=a.createParser(this.tracks[i].getTrackContent(),0,!1),s[i].curEvent=s[i].parser.next();do{for(l=-1,i=0,o=s.length;i<o;i++)s[i].curEvent&&(-1===l||s[i].curEvent.delta<s[l].curEvent.delta)&&(l=i);if(-1!==l){for(i=0,o=s.length;i<o;i++)i!==l&&s[i].curEvent&&(s[i].curEvent.delta-=s[l].curEvent.delta);u+=(n=s[l].curEvent).delta?n.delta*f/1e3:0,n.type===a.EVENT_META&&n.subtype===a.EVENT_META_SET_TEMPO&&(f=this.header.getTickResolution(n.tempo)),e&&n.type!==e||t&&(!n.subtype||n.subtype!==t)||(n.playTime=u,n.track=l,d.push(n)),s[l].curEvent=s[l].parser.next()}}while(-1!==l)}return d};getMidiEvents=function(){return this.getEvents(a.EVENT_MIDI)};getLyrics=function(){var e,t,r,i=this.getEvents(a.EVENT_META),o=[],s=[];for(t=0,r=i.length;t<r;t++)(e=i[t]).subtype===a.EVENT_META_LYRICS?s.push(e):e.subtype===a.EVENT_META_TEXT&&("@"===String.fromCharCode(e.data[0])?"T"===String.fromCharCode(e.data[1])||"I"===String.fromCharCode(e.data[1])||String.fromCharCode(e.data[1]):0===String.fromCharCode.apply(String,e.data).indexOf("words")?o.length=0:0!==e.playTime&&o.push(e));2<s.length?o=s:o.length||(o=[]);try{o.forEach((function(e){e.text=n.getStringFromBytes(e.data,0,e.length,!0)}))}catch(e){o.forEach((function(e){e.text=e.data.map((function(e){return String.fromCharCode(e)})).join("")}))}return o};getTrackEvents=function(e){var t,r,n=[];if(e>this.tracks.length||0>e)throw Error("Invalid track index ("+e+")");t=(r=a.createParser(this.tracks[e].getTrackContent(),0,!1)).next();do{n.push(t),t=r.next()}while(t);return n};setTrackEvents=function(e,t){var r,n;if(e>this.tracks.length||0>e)throw Error("Invalid track index ("+e+")");if(!t||!t.length)throw Error("A track must contain at least one event, none given.");r=a.getRequiredBufferLength(t),n=new Uint8Array(r),a.writeToTrack(t,n),this.tracks[e].setTrackContent(n)};deleteTrack=function(e){if(e>this.tracks.length||0>e)throw Error("Invalid track index ("+e+")");this.tracks.splice(e,1),this.header.setTracksCount(this.tracks.length)};addTrack=function(e){var t;if(e>this.tracks.length||0>e)throw Error("Invalid track index ("+e+")");t=new o,e===this.tracks.length?this.tracks.push(t):this.tracks.splice(e,0,t),this.header.setTracksCount(this.tracks.length)};getContent=function(){var e,t,r,n,a,o,s,l,u;for(e=i.HEADER_LENGTH,n=0,a=this.tracks.length;n<a;n++)e+=this.tracks[n].getTrackLength()+8;for(t=new Uint8Array(e),r=new Uint8Array(this.header.datas.buffer,this.header.datas.byteOffset,i.HEADER_LENGTH),n=0,a=i.HEADER_LENGTH;n<a;n++)t[n]=r[n];for(o=0,s=this.tracks.length;o<s;o++)for(r=new Uint8Array(this.tracks[o].datas.buffer,this.tracks[o].datas.byteOffset,this.tracks[o].datas.byteLength),l=0,u=this.tracks[o].datas.byteLength;l<u;l++)t[n++]=r[l];return t.buffer}}s.Header=i,s.Track=o;var l=null,u=null,d=null,c=null,f=0,E=null,h=0,m=0;function p(e,t){h=0,f=l.currentTime,m=l.currentTime,T(e,.044,t)}function T(e,t,r){l.currentTime>m-t&&(function(e,t,r,n,a,i,o){for(var s=0;s<e.tracks.length;s++)for(var l=e.tracks[s],u=0;u<l.notes.length;u++)if(l.notes[u].when>=r&&l.notes[u].when<n){var d=t+l.notes[u].when;(m=l.notes[u].duration)>3&&(m=3);var c=l.info.variable,f=l.volume/7;o.queueWaveTable(a,i,window[c],d,l.notes[u].pitch,m,f,l.notes[u].slides)}for(var E=0;E<e.beats.length;E++){var h=e.beats[E];for(u=0;u<h.notes.length;u++)if(h.notes[u].when>=r&&h.notes[u].when<n){d=t+h.notes[u].when;var m=1.5;c=h.info.variable,f=h.volume/2,o.queueWaveTable(a,i,window[c],d,h.n,m,f)}}}(e,f,h,h+t,l,E,u),m+=t,(h+=t)>e.duration||r())||window.requestAnimationFrame((function(n){T(e,t,r)}))}function g(e,t){var r=window.AudioContext||window.webkitAudioContext;l=new r,u=new WebAudioFontPlayer,c=u.createChannel(l),d=u.createReverberator(l),E=c.input,c.output.connect(d.input),d.output.connect(l.destination);for(var n=0;n<e.tracks.length;n++){const t=321;var a=u.loader.instrumentInfo(t);e.tracks[n].info=a,e.tracks[n].id=t,u.loader.startLoad(l,a.url,a.variable)}for(n=0;n<e.beats.length;n++){var i=u.loader.findDrum(e.beats[n].n);a=u.loader.drumInfo(i),e.beats[n].info=a,e.beats[n].id=i,u.loader.startLoad(l,a.url,a.variable)}u.loader.waitLoad((function(){l.resume(),t(e),c.band32.gain.setTargetAtTime(2,0,1e-4),c.band64.gain.setTargetAtTime(2,0,1e-4),c.band128.gain.setTargetAtTime(1,0,1e-4),c.band256.gain.setTargetAtTime(0,0,1e-4),c.band512.gain.setTargetAtTime(-1,0,1e-4),c.band1k.gain.setTargetAtTime(5,0,1e-4),c.band2k.gain.setTargetAtTime(4,0,1e-4),c.band4k.gain.setTargetAtTime(3,0,1e-4),c.band8k.gain.setTargetAtTime(-2,0,1e-4),c.band16k.gain.setTargetAtTime(2,0,1e-4)}))}},6223:(e,t,r)=>{r.d(t,{Z:()=>f});var n=r(8081),a=r.n(n),i=r(3645),o=r.n(i),s=r(1667),l=r.n(s),u=new URL(r(63),r.b),d=o()(a()),c=l()(u);d.push([e.id,"body {\r\n    margin: 0;\r\n    font-weight: 400;\r\n    font-size: 1em;\r\n    -webkit-font-smoothing: antialiased;\r\n    -moz-osx-font-smoothing: grayscale;\r\n}\r\n\r\nbody::after {\r\n    background: url("+c+') no-repeat top center;\r\n    background-size: cover;\r\n    height: 100vh;\r\n    content: "";\r\n    opacity: 0.4;\r\n    top: 0;\r\n    left: 0;\r\n    bottom: 0;\r\n    right: 0;\r\n    position: fixed;\r\n    z-index: -1;\r\n}\r\n\r\n.align-center {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    margin: 20px 0px;\r\n}\r\n\r\n.home {\r\n    flex: 1;\r\n    display: flex;\r\n    margin-top: 30vh;\r\n    flex-direction: column;\r\n    flex-shrink: 0;\r\n}\r\n\r\n.btn-primary,\r\n.btn-primary:hover,\r\n.btn-primary:active,\r\n.btn-primary:active:focus,\r\n.btn-primary:focus,\r\n.btn-primary:visited {\r\n    background-color: #1c687d !important;\r\n    border-width: 0 !important;\r\n    border-radius: 20px !important;\r\n    width: 12vw !important;\r\n    min-width: 150px !important;\r\n    outline: none !important;\r\n    box-shadow: none !important;\r\n}\r\n\r\n.footer {\r\n    position: fixed;\r\n    padding: 5px;\r\n    left: 0;\r\n    bottom: 0;\r\n    width: 100%;\r\n    background-color: #ffffff;\r\n    text-align: center;\r\n    color: gray;\r\n    font-weight: 200;\r\n    font-size: 0.8em;\r\n}\r\n\r\n.content {\r\n    margin: auto;\r\n    margin-top: 2vh;\r\n    padding-top: 15px;\r\n    padding-left: 25px;\r\n    padding-bottom: 10px;\r\n    padding-right: 25px;\r\n    width: 75%;\r\n    align-self: center;\r\n    background-color: #ffffff;\r\n    border-radius: 20px;\r\n    opacity: 0.85;\r\n    margin-bottom: 80px;\r\n}\r\n\r\n.navbar-logo {\r\n    color: #165565 !important;\r\n    font-weight: 650;\r\n}\r\n\r\n.photo {\r\n    width: 125px;\r\n    height: 125px;\r\n    margin-left: auto;\r\n    margin-right: 3vw;\r\n    border-radius: 50%;\r\n    object-fit: cover;\r\n    filter: gray;\r\n    -webkit-filter: grayscale(1);\r\n}\r\n\r\n.photo:hover {\r\n    filter: none;\r\n    -webkit-filter: grayscale(0);\r\n}\r\n\r\n.disable-select {\r\n    user-select: none; /* supported by Chrome and Opera */\r\n    -webkit-user-select: none; /* Safari */\r\n    -khtml-user-select: none; /* Konqueror HTML */\r\n    -moz-user-select: none; /* Firefox */\r\n    -ms-user-select: none; /* Internet Explorer/Edge */\r\n}\r\n\r\n@media screen and (max-width: 600px) {\r\n    .hide {\r\n        display: none;\r\n    }\r\n\r\n    .navbar-center {\r\n        left: auto;\r\n    }\r\n\r\n    .link-input {\r\n        width: auto;\r\n        padding: 5px 5px;\r\n    }\r\n}\r\n',""]);const f=d},2358:(e,t,r)=>{r.r(t),r.d(t,{default:()=>T});var n=r(3379),a=r.n(n),i=r(7795),o=r.n(i),s=r(569),l=r.n(s),u=r(3565),d=r.n(u),c=r(9216),f=r.n(c),E=r(4589),h=r.n(E),m=r(6223),p={};p.styleTagTransform=h(),p.setAttributes=d(),p.insert=l().bind(null,"head"),p.domAPI=o(),p.insertStyleElement=f(),a()(m.Z,p);const T=m.Z&&m.Z.locals?m.Z.locals:void 0},9303:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(r(7294));t.default=function(){return a.default.createElement("span",{className:"footer disable-select"},"RiffBuddy was created for the UoL BSc Computer Science course CM3070. All rights reserved.")}},8835:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.NavBarPage=void 0;var a,i=n(r(7294)),o=r(3879);!function(e){e[e.About=0]="About",e[e.Home=1]="Home"}(a=t.NavBarPage||(t.NavBarPage={})),t.default=function(e){return i.default.createElement("nav",{className:"navbar navbar-expand-lg navbar-light",style:{backgroundColor:"#FFFFFF"}},i.default.createElement(o.Link,{className:"navbar-logo disable-select ".concat(e.activePage===a.Home&&"active"),to:"/"},"Riff Buddy"),i.default.createElement("button",{className:"navbar-toggler disable-select",type:"button","data-toggle":"collapse","data-target":"#navbarNav","aria-controls":"navbarNav","aria-expanded":"false","aria-label":"Toggle navigation"},i.default.createElement("span",{className:"navbar-toggler-icon"})),i.default.createElement("div",{className:"collapse navbar-collapse",id:"navbarNav"},i.default.createElement("ul",{className:"navbar-nav mr-auto"},i.default.createElement("li",{className:"nav-item ".concat(e.activePage===a.Home?"active":"")},i.default.createElement(o.Link,{className:"nav-link disable-select",to:"/"},"Generate")),i.default.createElement("li",{className:"nav-item ".concat(e.activePage===a.About?"active":"")},i.default.createElement(o.Link,{className:"nav-link disable-select",to:"/about"},"About"))),i.default.createElement("ul",{className:"navbar-nav"},i.default.createElement("li",{className:"nav-item"},i.default.createElement("a",{href:"mailto:dmitrii.io@protonmail.com",className:"nav-link disable-select"},"Feedback")))))}},8935:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(r(7294)),i=n(r(3935)),o=r(3879),s=n(r(4738)),l=n(r(7225)),u=n(r(7270));r(2358),i.default.render(a.default.createElement((function(){return a.default.createElement(o.BrowserRouter,null,a.default.createElement(o.Routes,null,a.default.createElement(o.Route,{path:"*",element:a.default.createElement(u.default,null)}),a.default.createElement(o.Route,{path:"/",element:a.default.createElement(s.default,null)}),a.default.createElement(o.Route,{path:"/about",element:a.default.createElement(l.default,null)})))}),null),document.getElementById("root"))},1861:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.b64toBlob=void 0,t.b64toBlob=function(e,t,r){if(void 0===t&&(t=""),void 0===r&&(r=512),e){for(var n=atob(e),a=[],i=0;i<n.length;i+=r){for(var o=n.slice(i,i+r),s=new Array(o.length),l=0;l<o.length;l++)s[l]=o.charCodeAt(l);var u=new Uint8Array(s);a.push(u)}return new Blob(a,{type:t})}return new Blob}},7225:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(r(7294)),i=n(r(8835)),o=r(8835),s=n(r(9303));t.default=function(){return a.default.createElement("div",{className:"about"},a.default.createElement(i.default,{activePage:o.NavBarPage.About}),a.default.createElement("div",{className:"content",style:{marginBottom:0}},a.default.createElement("h1",{className:"display-4"},"What is Riff Buddy?"),a.default.createElement("p",{className:"lead"},"Riff Buddy aims to help with music composition. It provides generative ideas for a given piece of music to help you be more creative."),a.default.createElement("p",{className:"lead"},"This Web Application and generative models were designed and built as part of the final project of the CM3070 module.")),a.default.createElement("div",{className:"content"},a.default.createElement("h1",{className:"display-4"},"Who designed Riff Buddy?"),a.default.createElement("p",{className:"lead"},"I am a BSc Computer Science student, and a full-time software engineer @AWS."),a.default.createElement("div",{className:"container-fluid"},a.default.createElement("div",{className:"row py-2"},a.default.createElement("div",{className:"col-auto"},a.default.createElement("img",{className:"photo",src:r(5062),alt:"Dmitrii Vasilev"})),a.default.createElement("div",{className:"col"},a.default.createElement("p",null,"Dmitrii Vasilev"))))),a.default.createElement(s.default,null))}},7270:function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var a=n(r(7294));t.default=function(){return a.default.createElement("h1",null,"404 NOT FOUND")}},4738:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return a(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var s=o(r(9669)),l=i(r(7294)),u=o(r(9303)),d=i(r(8835)),c=r(7788),f=r(1861);t.default=function(){var e=(0,l.useState)(),t=e[0],r=e[1],n=(0,l.useState)("magenta"),a=n[0],i=n[1],o=(0,l.useState)([]),E=o[0],h=o[1],m=(0,l.useState)(!1),p=m[0],T=m[1],g=(0,l.useState)(-1),_=g[0],b=g[1],v=(0,l.useState)(!1),N=v[0],y=v[1],w=(0,l.useState)(""),M=w[0],I=w[1],A=l.default.useRef();A.current=N;var k=function(){return y(!1)},C=function(e,t){void 0===t&&(t=0);var r=function(){return!A.current},n=function(e){var t=new FileReader;t.onload=function(e){var t=e.target.result,n=new c.MIDIFile(t);(0,c.startLoad)(n.parseSong(),(function(e){b(-1),y(!0),(0,c.startPlay)(e,r)}))},t.readAsArrayBuffer(e)};b(t),A.current?(y(!1),setTimeout((function(){n(e)}),1e3)):n(e)};return l.default.createElement(l.default.Fragment,null,l.default.createElement(d.default,{activePage:d.NavBarPage.Home}),l.default.createElement("div",{className:"home"},l.default.createElement("div",{className:"row",style:{margin:"0"}},l.default.createElement("div",{className:"col-2"}),l.default.createElement("div",{className:"col-".concat(E.length>0?"4":"8"),style:{maxWidth:"100%"}},l.default.createElement("div",{className:"dropdown align-center"},l.default.createElement("button",{className:"btn btn-secondary dropdown-toggle",type:"button",id:"dropdownMenuButton","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},"riffBuddy"===a?"RiffBuddy RNN":"magenta"===a?"Magenta RNN":"Choose model"),l.default.createElement("div",{className:"dropdown-menu","aria-labelledby":"dropdownMenuButton"},l.default.createElement("button",{className:"dropdown-item",type:"button",onClick:function(){return i("magenta")}},"Magenta RNN"),l.default.createElement("button",{className:"dropdown-item",type:"button",onClick:function(){return i("riffBuddy")}},"RiffBuddy RNN"))),"riffBuddy"==a&&l.default.createElement("div",{className:"align-center"},l.default.createElement("span",{className:"text-dark"},"Please make sure your MIDI has at least 32 notes.")),l.default.createElement("div",{className:"align-center"},l.default.createElement("input",{className:"btn btn-dark",type:"file",onChange:function(e){y(!1);var t=e.target.files[0];r(t)}})),t&&l.default.createElement("div",{className:"align-center"},l.default.createElement("button",{className:"bi bi-stop-btn btn btn-danger",style:{fontSize:20},onClick:function(){return k()}}),l.default.createElement("button",{className:"bi bi-play-btn".concat(0===_?"-fill":""," btn btn-success"),style:{fontSize:20},onClick:function(){return C(t)},disabled:0===_})),l.default.createElement("div",{className:"align-center"},l.default.createElement("button",{className:"btn btn-primary",onClick:function(){var e=new FormData;e.append("midi",t),e.set("model",a),T(!0),I(""),h([]),s.default.post("/generate",e,{headers:{"content-type":"multipart/form-data"}}).then((function(e){var t=e.data;h(t.map((function(e){return(0,f.b64toBlob)(e,"audio/mid")})))})).catch((function(e){return I(String(e))})).finally((function(){return T(!1)}))},disabled:!t||!a||p},p?l.default.createElement("div",{className:"spinner-grow",role:"status"},l.default.createElement("span",{className:"sr-only"},"Loading...")):"Generate")),p&&l.default.createElement("div",{className:"align-center"},l.default.createElement("span",{className:"text-primary"},"Generating melodies. Might take a minute.")),M&&l.default.createElement("div",{className:"align-center"},l.default.createElement("span",{className:"text-danger"},M))),E.length>0&&l.default.createElement("div",{className:"col-4",style:{maxWidth:"100%",marginBottom:"50px"}},E.map((function(e,t){return l.default.createElement("div",{className:"align-center"},l.default.createElement("b",{style:{marginRight:"10px"}},"Generated_Riff_".concat(t+1,".mid")),l.default.createElement("span",{className:"bi bi-stop-btn btn btn-danger",style:{fontSize:20},onClick:k}),l.default.createElement("span",{className:"bi bi-play-btn btn btn-success",style:{fontSize:20},onClick:function(){return C(e,t+1)}}),l.default.createElement("span",{className:"bi bi-download btn btn-secondary",style:{fontSize:20},onClick:function(){return t=e,void(window.location=URL.createObjectURL(t));var t}}))}))),l.default.createElement("div",{className:"col-2"}))),l.default.createElement(u.default,null))}},63:(e,t,r)=>{e.exports=r.p+"ff422ae29f43b5d3e803.jpg"},5062:(e,t,r)=>{e.exports=r.p+"483128c3b42ce8ee8969.jpg"}},r={};function n(e){var a=r[e];if(void 0!==a)return a.exports;var i=r[e]={id:e,exports:{}};return t[e].call(i.exports,i,i.exports,n),i.exports}n.m=t,e=[],n.O=(t,r,a,i)=>{if(!r){var o=1/0;for(d=0;d<e.length;d++){for(var[r,a,i]=e[d],s=!0,l=0;l<r.length;l++)(!1&i||o>=i)&&Object.keys(n.O).every((e=>n.O[e](r[l])))?r.splice(l--,1):(s=!1,i<o&&(o=i));if(s){e.splice(d--,1);var u=a();void 0!==u&&(t=u)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[r,a,i]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="static/",(()=>{n.b=document.baseURI||self.location.href;var e={179:0};n.O.j=t=>0===e[t];var t=(t,r)=>{var a,i,[o,s,l]=r,u=0;if(o.some((t=>0!==e[t]))){for(a in s)n.o(s,a)&&(n.m[a]=s[a]);if(l)var d=l(n)}for(t&&t(r);u<o.length;u++)i=o[u],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(d)},r=self.webpackChunkriff_buddy=self.webpackChunkriff_buddy||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),n.nc=void 0;var a=n.O(void 0,[216],(()=>n(8935)));a=n.O(a)})();